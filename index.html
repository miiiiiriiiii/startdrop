<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>별똥별 잡기 ✨</title>
  <style>
    :root { --pixel: 3; --accent: #ffcc00; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: linear-gradient(180deg, #99ccff, #ffffff);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", Arial, sans-serif;
      overflow: hidden;
      image-rendering: pixelated;
    }
    .frame { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .hud { position: absolute; top: 10px; left: 10px; display: flex; gap: 20px; font-size: 20px; font-weight: 800; z-index: 5; }

    .star {
      position: absolute; z-index: 3;
      width: calc(4px * var(--pixel));
      height: calc(4px * var(--pixel));
      background: var(--accent);
      box-shadow:
        0 calc(-4px * var(--pixel)) 0 var(--accent),
        0 calc(4px * var(--pixel)) 0 var(--accent),
        calc(-4px * var(--pixel)) 0 0 var(--accent),
        calc(4px * var(--pixel)) 0 0 var(--accent);
      border: calc(2px * var(--pixel)) solid #000;
      border-radius: calc(2px * var(--pixel));
      cursor: crosshair;
      animation: fall linear forwards;
      touch-action: none; /* 모바일 탭 지연 방지 */
    }
    /* 보이지 않는 넉넉한 히트박스 (모바일 클릭 보정) */
    .star::after {
      content: "";
      position: absolute;
      left: calc(-4px * var(--pixel));
      top:  calc(-4px * var(--pixel));
      width: calc(4px * var(--pixel) + 8px * var(--pixel));
      height: calc(4px * var(--pixel) + 8px * var(--pixel));
      background: rgba(0,0,0,0);
    }

    @keyframes fall { from { transform: translateY(-10%);} to { transform: translateY(100vh);} }

    .wish { position: absolute; font-size: 20px; font-weight: 900; color: #ff66cc; text-shadow: 1px 1px 2px #000; animation: pop .8s ease-out forwards; pointer-events: none; z-index: 6; }
    @keyframes pop { 0%{opacity:0; transform: scale(.8) translateY(0);} 30%{opacity:1;} 100%{opacity:0; transform: scale(1.2) translateY(-40px);} }

    .overlay { position: absolute; inset: 0; background: rgba(255,255,255,.9); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; z-index: 10; }
    .overlay button { margin-top: 20px; padding: 10px 20px; font-size: 18px; font-weight: 800; cursor: pointer; border: 2px solid #000; border-radius: 6px; background: #ffcc00; }
  </style>
</head>
<body>
  <div class="frame" id="frame">
    <div class="hud">
      <div>점수: <span id="score">0</span></div>
      <div>시간: <span id="time">20</span>s</div>
    </div>
    <div class="overlay" id="overlay">
      <h1>별똥별 잡기 ✨</h1>
      <p>20초 동안 별을 클릭해 점수를 모아보세요!</p>
      <button id="startBtn">게임 시작</button>
    </div>
  </div>
  <script>
    (function(){
      const frame = document.getElementById('frame');
      const scoreEl = document.getElementById('score');
      const timeEl = document.getElementById('time');
      const overlay = document.getElementById('overlay');

      let score = 0;
      let timeLeft = 20;
      let spawnTimer = null;
      let tickTimer = null;
      let running = false;

      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
      const rand = (min, max) => Math.random() * (max - min) + min;

      function clearTimers(){
        if (spawnTimer) { clearInterval(spawnTimer); spawnTimer = null; }
        if (tickTimer) { clearInterval(tickTimer); tickTimer = null; }
      }

      function resetScene(){
        clearTimers();
        $$('.star', frame).forEach(s => s.remove());
        score = 0; timeLeft = 20; running = false;
        scoreEl.textContent = score;
        timeEl.textContent = timeLeft;
      }

      function startGame(){
        resetScene();
        overlay.classList.add('hidden');
        overlay.style.display = 'none';
        overlay.style.pointerEvents = 'none';
        running = true;

        // 더 자주/빠르게 떨어지도록 기본값
        spawnTimer = setInterval(spawnStar, 550);
        tickTimer = setInterval(() => {
          timeLeft -= 1;
          timeEl.textContent = timeLeft;
          if (timeLeft <= 0) endGame();
        }, 1000);
      }

      function endGame(){
        running = false;
        clearTimers();
        $$('.star', frame).forEach(s => s.style.pointerEvents = 'none');
        overlay.style.display = 'flex';
        overlay.style.pointerEvents = 'auto';
        overlay.classList.remove('hidden');
        overlay.innerHTML = `<h2>게임 종료! 점수: ${score}</h2><button id="retryBtn" class="btn">다시 하기</button>`;
      }

      function spawnStar(){
        if (!running) return;
        const star = document.createElement('div');
        star.className = 'star';
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        star.style.left = rand(20, vw - 40) + 'px';
        star.style.top = '-40px';
        star.style.animationDuration = rand(1.8, 3.2) + 's';

        star.addEventListener('pointerdown', (e) => {
          if (!running || star.dataset.hit) return;
          star.dataset.hit = '1';
          score += 1; scoreEl.textContent = score;
          showWish(e.clientX, e.clientY);
          star.remove();
        });

        star.addEventListener('animationend', () => star.remove());
        frame.appendChild(star);
      }

      function showWish(x, y){
        const w = document.createElement('div');
        w.className = 'wish';
        w.textContent = 'Make a wish!';
        w.style.left = x + 'px';
        w.style.top = y + 'px';
        frame.appendChild(w);
        setTimeout(() => w.remove(), 800);
      }

      // 이벤트 위임: 시작/다시하기 버튼 모두 커버
      document.addEventListener('pointerdown', (e) => {
        const id = (e.target && e.target.id) || '';
        if (id === 'startBtn' || id === 'retryBtn') {
          e.preventDefault();
          startGame();
        }
      });

      // 키보드 진입성: Enter/Space 로 시작
      document.addEventListener('keydown', (e) => {
        if (!running && (e.key === 'Enter' || e.key === ' ')) {
          startGame();
        }
      });

      // 혹시 오버레이가 스타일로 가로막을 수 있으니 기본 상태 명시
      overlay.style.pointerEvents = 'auto';
    })();
  </script>
</body>
</html>
