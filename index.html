<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>별똥별 잡기 ✨</title>
  <style>
    :root { --pixel: 3; --star: #ffff33; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; height: 100vh; overflow: hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% -20%, #0a2a6b 0%, #050d25 60%, #000 100%);
      color: #fff;
    }

    .frame { position: relative; width: 100%; height: 100%; overflow: hidden; }

    .hud {
      position: absolute; top: 10px; left: 10px; display: flex; gap: 20px;
      font-size: 20px; font-weight: 800; z-index: 5; text-shadow: 0 2px 0 #000;
    }
    .overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,.65);
      display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
      z-index: 10; color:#fff;
    }
    .overlay h1, .overlay h2 { margin: 0 0 10px; text-shadow: 0 2px 0 #000; }
    .overlay button { margin-top: 16px; padding: 10px 20px; font-size: 18px; font-weight: 800; cursor: pointer; border: 2px solid #000; border-radius: 6px; background: var(--star); color:#000; }

    /* 별 컨테이너 (위치/애니메이션 담당) */
    .star {
      position: absolute; z-index: 3; width: 28px; height: 28px; /* 기본, JS에서 개별 조정 */
      animation: fall linear forwards;
      cursor: crosshair; touch-action: none;
    }
    @keyframes fall { from { transform: translateY(-12%);} to { transform: translateY(112vh);} }

    /* 소원 텍스트 */
    .wish {
      position: absolute; font-size: 18px; font-weight: 900; color: #ffe6a6;
      text-shadow: 0 2px 0 #000, 2px 0 0 #000, -2px 0 0 #000, 0 -2px 0 #000;
      animation: pop .9s ease-out forwards; pointer-events: none; z-index: 6;
    }
    @keyframes pop { 0%{opacity:0; transform: scale(.85) translateY(0);} 30%{opacity:1;} 100%{opacity:0; transform: scale(1.1) translateY(-46px);} }
  </style>
</head>
<body>
  <div class="frame" id="frame">
    <div class="hud">
      <div>점수: <span id="score">0</span></div>
      <div>시간: <span id="time">20</span>s</div>
    </div>
    <div class="overlay" id="overlay">
      <h1>별똥별 잡기 ✨</h1>
      <p>20초 동안 별(노란색)을 클릭해 점수를 모아보세요!</p>
      <button id="startBtn">게임 시작</button>
    </div>
  </div>

  <script>
    (function(){
      const frame = document.getElementById('frame');
      const scoreEl = document.getElementById('score');
      const timeEl = document.getElementById('time');
      const overlay = document.getElementById('overlay');

      let score = 0;
      let timeLeft = 20;
      let spawnTimer = null;
      let tickTimer = null;
      let running = false;

      const SVG_NS = 'http://www.w3.org/2000/svg';
      const rand = (min, max) => Math.random() * (max - min) + min;

      function clearTimers(){ if (spawnTimer) clearInterval(spawnTimer); if (tickTimer) clearInterval(tickTimer); spawnTimer=null; tickTimer=null; }

      function resetScene(){
        clearTimers();
        [...document.querySelectorAll('.star')].forEach(s => s.remove());
        score = 0; timeLeft = 20; running = false;
        scoreEl.textContent = score; timeEl.textContent = timeLeft;
      }

      function startGame(){
        resetScene();
        overlay.style.display = 'none';
        overlay.style.pointerEvents = 'none';
        running = true;
        // 스폰 간격
        spawnTimer = setInterval(spawnStar, 700);
        // 카운트다운
        tickTimer = setInterval(() => {
          timeLeft -= 1; timeEl.textContent = timeLeft;
          if (timeLeft <= 0) endGame();
        }, 1000);
      }

      function endGame(){
        running = false; clearTimers();
        [...document.querySelectorAll('.star')].forEach(s => s.style.pointerEvents = 'none');
        overlay.style.display = 'flex'; overlay.style.pointerEvents = 'auto';
        overlay.innerHTML = `<h2>게임 종료! 점수: ${score}</h2><button id="retryBtn">다시 하기</button>`;
      }

      // ★ 별을 SVG로 그려서 색상 강제: fill=#ffff33 (노란색), stroke=#000
      function createStarSVG(size){
        const svg = document.createElementNS(SVG_NS, 'svg');
        svg.setAttribute('width', size);
        svg.setAttribute('height', size);
        svg.setAttribute('viewBox', '0 0 100 100');
        svg.setAttribute('aria-hidden', 'true');

        const poly = document.createElementNS(SVG_NS, 'polygon');
        // 5각 별 포인트 (정가운데 중심 기준)
        poly.setAttribute('points', '50,5 61,38 95,38 67,58 76,91 50,72 24,91 33,58 5,38 39,38');
        poly.setAttribute('fill', '#ffff33');
        poly.setAttribute('stroke', '#000');
        poly.setAttribute('stroke-width', '4');
        poly.setAttribute('vector-effect', 'non-scaling-stroke');

        svg.appendChild(poly);
        return svg;
      }

      function spawnStar(){
        if (!running) return;
        const star = document.createElement('div');
        star.className = 'star';

        // 크기/위치/속도 랜덤
        const size = Math.round(rand(22, 34));
        star.style.width = size + 'px';
        star.style.height = size + 'px';

        const vw = window.innerWidth;
        const left = rand(size, vw - size);
        star.style.left = left + 'px';
        star.style.top = (-size - 12) + 'px';

        // 더 천천히 떨어지도록 (4.2 ~ 7.8초)
        const dur = rand(4.2, 7.8);
        star.style.animationDuration = dur + 's';

        // SVG 별 아이콘 삽입 (노란색 보장)
        const svg = createStarSVG(100); // 컨테이너에 맞게 CSS로 축소됨
        svg.style.width = '100%';
        svg.style.height = '100%';
        star.appendChild(svg);

        // 클릭 처리
        star.addEventListener('pointerdown', (e) => {
          if (!running || star.dataset.hit) return;
          star.dataset.hit = '1';
          score += 1; scoreEl.textContent = score;
          showWish(e.clientX, e.clientY);
          star.remove();
        });

        star.addEventListener('animationend', () => star.remove());
        frame.appendChild(star);
      }

      function showWish(x, y){
        const w = document.createElement('div');
        w.className = 'wish';
        w.textContent = 'Make a wish!';
        w.style.left = x + 'px';
        w.style.top = y + 'px';
        frame.appendChild(w);
        setTimeout(() => w.remove(), 900);
      }

      // 시작/재시작 이벤트 바인딩 (직접 + 위임)
      document.addEventListener('pointerdown', (e) => {
        const id = (e.target && e.target.id) || '';
        if (id === 'startBtn' || id === 'retryBtn') { e.preventDefault(); startGame(); }
      });
      document.addEventListener('click', (e) => {
        const id = (e.target && e.target.id) || '';
        if (id === 'startBtn' || id === 'retryBtn') { e.preventDefault(); startGame(); }
      });
      window.addEventListener('DOMContentLoaded', () => {
        const sb = document.getElementById('startBtn');
        if (sb) {
          sb.addEventListener('click', (e) => { e.preventDefault(); startGame(); });
          sb.addEventListener('pointerdown', (e) => { e.preventDefault(); startGame(); });
        }
      });
      document.addEventListener('keydown', (e) => { if (!running && (e.key === 'Enter' || e.key === ' ')) startGame(); });
      overlay.style.pointerEvents = 'auto';
    })();
  </script>
</body>
</html>
